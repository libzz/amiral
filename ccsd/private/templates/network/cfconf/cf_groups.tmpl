#*doc-module:
crcnetd - CRCnet Configuration System Daemon Template

This template assigns hosts to groups
*#
#attr $author = "Matt Brown <matt@crc.net.nz>"
#attr $version = "$Id$"
#attr $copyright = "Copyright (C) 2006  The University of Waikato"
#attr $license = "No usage or redistribution rights are granted. See LICENSE for details."
#attr $eventList = []
#attr $fileName = "cf.groups"
#from crcnetd._utils.ccsd_cfengine import ccs_template
#extends ccs_template
#compiler-settings
## Change the Cheetah start tokens so that we don't conflict with CFengine
cheetahVarStartToken = %
directiveStartToken = !
commentStartToken = !!
EOLSlurpToken = ^^^
#end compiler-settings
#############################################################
#
# cf.groups -- for %domain 
# $Date$
#
# This file contains group/class definitions, particularly
# for basic classes like distributions
#
# WARNING: Do not modify this file since it is automatically
#          generated by cf.py
#
#############################################################

###########
#
# BEGIN cf.groups
#
###########

groups:

    # Define distribution groups
!for %distribution_id,%distrib in %distributions.items()
    !set %dhosts = []
    !for %host_name,%host in %hosts.items()
        !if %host.distribution_id != %distribution_id
            !continue
        !end if
        !set %a = %dhosts.append(%host.host_name)
    !end for
    !if len(%dhosts) > 0
    Distrib_%distrib.name = (
        !for %host in %dhosts
        %host
        !end for
    )

    !end if
!end for

    # Detect CPE devices
    CPE = ( FileExists(/etc/cpe_version) )

    # Define service groups
!for %serviceName,%service in %services.items()
    !if len(%service.hosts) <= 0
        !continue
    !end if
    Service_%serviceName = (
    !for %host in %service.hosts
        !if %hosts[%host].host_active
        %host
        !end if
    !end for
    )
!end for

    # Define asset based groups
!for %asset_type_id,%atype in %asset_types.items()
    !if %atype.host_count <= 0
        !continue
    !end if
    AssetType_%atype["mangled_description"] = (
    !for %host in %atype.hosts
        %host
    !end for
    )
!end for

###########
#
# END cf.groups
#
###########
