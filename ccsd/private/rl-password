#!/usr/bin/python
# Copyright (C) 2006  The University of Waikato
#
# This file is part of crcnetd - CRCnet Configuration System Daemon
#
# Rural Link autoconfiguration and management functionality
#
# Author:       Matt Brown <matt@crc.net.nz>
# Version:      $Id$
#
# No usage or redistribution rights are granted for this file unless
# otherwise confirmed in writing by the copyright holder.
import sys
from md5 import md5

##############################################################################
# Utility Functions
##############################################################################
def getDevicePassword(mac, rl_pass):
    """Returns the device's password

    This password is generated by taking the Rural Link root password, 
    concatenating it with the devices MAC address and returning the last 8
    characters of an md5sum of the two
    """
    
    # Calculate and return the password
    sum = md5("%s%s" % (rl_pass, mac)).hexdigest()
    return sum[-8:]

if len(sys.argv) < 2:
    sys.stderr.write("Usage: %s <mac>\n" % sys.argv[0])
    sys.exit(1)

print "Rural Link Root Password Utility"
print "================================"
print ""
print "Device MAC Address: %s" % sys.argv[1]
print ""
print "Enter Rural Link Root Password: ",
password = sys.stdin.readline().strip()
print ""
print "Device Root Password: %s" % getDevicePassword(sys.argv[1], password)
